<!--
FileName: index.html
Author: Nicholas Lin
Date: 3/3/20
Description: Main landing lage of the web app
-->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="./assets/img/favicon.ico">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <title>
    Capital One Summit
  </title>
  <!-- Bootstrap core CSS -->
  <link href="./assets/css/bootstrap.css" rel="stylesheet">

  <!-- Custom styles for this page -->
  <link href="./assets/css/ionicons.min.css" rel="stylesheet">
  <link href="./assets/css/style.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="./assets/js/ie10-viewport-bug-workaround.js"></script>

</head>

<body>
  <div id="h" class="landingbackground">
    <div class="container">
      <div class="row">
        <div class="col-md-10 col-md-offset-1 centered">
          <h1>
            <table>
            </table> What are you craving?
          </h1>
          <div class="mtb">
            <form id="main-form" role="form" action="/search" method="post" enctype="plain">
              <div class="col-md-6">
                <input id="searchterm" type="text" name="term" class="text-input"
                  placeholder="Mexican, Chinese, Burgers...">
              </div>
              <div class="col-md-6">
                <input type="text" id="location" name="location" class="text-input" placeholder="address, city, state, zip..." required>
              </div>
              <button class='btn btn-conf btn-blue-landing' type="submit"> Take me there! </button>
            </form>
          </div>
          <!--/mt-->
          <h5> Discover a new experience. </h5>
          <h6> Created by <a href="www.linkedin.com/in/nlin10"> Nicholas Lin. </a> Powered by <a
              href="https://www.yelp.com/developers"> Yelp's Fusion API. </a> </h6>
        </div>
      </div>
      <!--/row-->
    </div>
    <!--/container-->
  </div><!-- /H -->

  <script>

    //This script resolves a location in the location input to coordinates and passes these coordinates in as URL parameters

    // Get location form
    var locationForm = document.getElementById('main-form');
    // Listen for submit
    locationForm.addEventListener('submit', geocode);

    getLocation();

    //This function gets the current location of the user
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(autoFillLocation);
      } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
      }
    }

    //This function uses Geocode to autofill the location input from user coordinates
    function autoFillLocation(position) {
      lat = position.coords.latitude;
      lon = position.coords.longitude;
      var latlng = { lat: parseFloat(lat), lng: parseFloat(lon) };
      var geocoder = new google.maps.Geocoder;
      geocoder.geocode({ 'location': latlng }, function (results, status) {
        if (status === 'OK') {
          if (results[0]) {
            document.getElementById("location").defaultValue = results[0].formatted_address;
          } else {
            window.alert('No results found');
          }
        } else {
          window.alert('Geocoder failed due to: ' + status);
        }
      });
    }

    //This function translates the address to coordinates and passes these parameters to redirect
    function geocode(e) {
      // Prevent actual submit
      e.preventDefault();

      var location = document.getElementById('location').value;

      axios.get('https://maps.googleapis.com/maps/api/geocode/json', {
        params: {
          address: location,
          key: 'AIzaSyCZov1f1Cpq5p5HyPpgz9aoGIqWYr4ZJU0'
        }
      })
        .then(function (response) {
          // Formatted Address
          var formattedAddress = response.data.results[0].formatted_address;

          // Geometry
          var lat = response.data.results[0].geometry.location.lat;
          var lng = response.data.results[0].geometry.location.lng;
          redirect(lat, lng);
        })
        .catch(function (error) {
          console.log(error);
        });
    }

    //This function redirects the user to the main search results page and passes location parameters in the URL
    function redirect(lat, lng) {
      var queryString = "?" + lat + "&" + lng + "&" + document.getElementById('searchterm').value;
      window.location.href = "./search.html" + queryString;
    }

  </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZov1f1Cpq5p5HyPpgz9aoGIqWYr4ZJU0"></script>
  <script src="./assets/js/jquery.min.js"></script>
  <script src="./assets/js/bootstrap.min.js"></script>
  <script src="./assets/js/retina-1.1.0.js"></script>

</body>

</html>